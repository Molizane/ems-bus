{
    "name": "ems_user_email_loader_db",
	"comment": "Catalog for ems_user_email_loader_db",
	"owner": "emsbus",
	"version": "1.0.0",
	"service" : "ems_data_loader:start",
	"url": "/emsbus/ems_user_email_loader_db",
	"async": "false",
	"type": "KERNEL",
	"lang" : "erlang",
	"update_checkpoint" : 180000,
	"datasource" : "ds_ems_user_loader",
	"start_timeout" : 12000,
	"middleware" : "ems_user_email_loader_middleware",
	"pool_size" : 1,
	"pool_max" : 1,
	"enable" : false,
	"sql_load" : 
				"select 
				   em.EmaCodigo as codigo,
				   p.PesCodigoPessoa as codigo_pessoa,
				   cast(coalesce(em.EmaEmail, p.PesEmail) as varchar(60)) as email,
				   em.EmaTipo as type 
				from BDPessoa.dbo.TB_Pessoa p 
						join BDPessoa.dbo.TB_PessoaFisicaEmail pfe  
								on p.PesCodigoPessoa = pfe.PFmPesCodigoPessoa 
						join BDPessoa.dbo.TB_Email em 
								on pfe.PFmEmaCodigo = em.EmaCodigo 
                ",

	"sql_update" : 
				"select 
				   em.EmaCodigo as codigo,
				   p.PesCodigoPessoa as codigo_pessoa,
				   cast(coalesce(em.EmaEmail, p.PesEmail) as varchar(60)) as email,
				   em.EmaTipo as type 
				from BDPessoa.dbo.TB_Pessoa p 
						join BDPessoa.dbo.TB_PessoaFisicaEmail pfe  
								on p.PesCodigoPessoa = pfe.PFmPesCodigoPessoa 
						join BDPessoa.dbo.TB_Email em 
								on pfe.PFmEmaCodigo = em.EmaCodigo 
				where em.EmaDataAlteracao >= ? or em.EmaDataCadastramento >= ?
                ",

			
	"fields" : ["codigo", "codigo_pessoa", "email", "type"]
				
}
