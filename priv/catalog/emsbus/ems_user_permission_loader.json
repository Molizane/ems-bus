{
    "name": "ems_user_permission_loader",
	"comment": "Catalog for ems_user_permission_loader",
	"owner": "emsbus",
	"version": "1",
	"service" : "ems_user_permission_loader:start",
	"url": "/emsbus/ems_user_permission_loader",
	"async": "false",
	"type": "KERNEL",
	"lang" : "erlang",
	"update_checkpoint" : 65000,
	"datasource" : "ds_ems_user_loader",	
	"pool_size" : 1,
	"pool_max" : 1,
	"enable" : false,
	"sql_load_permissions" : 
			"select distinct  u.UsuPesIdPessoa as UserId,
								pt.PTrVisualizar as GrantGet,
								pt.PTrIncluir as GrantPost, 
								pt.PTrAlterar as UpdateGrant, 
								pt.PTrExcluir as GrantDelete,
								t.TraNomeFrm as Url,
								t.TraNomeMenu as name,
								u.UsuPesIdPessoa as user_id,  
								s.SisId as sis_id,
								pt.PTrId perfil_id
					from BDAcesso.dbo.TB_Usuario u join BDAcesso.dbo.TB_Acessos_Perfil up  
							on u.UsuId = up.APeUsuId 
					inner join BDAcesso.dbo.TB_Perfil p 
							on up.APePerId = p.PerId 
					inner join BDAcesso.dbo.TB_Perfil_Transacao pt 
							on p.PerId = pt.PTrPerId 
					inner join BDAcesso.dbo.TB_Transacao t 
							on pt.PTrTraId = t.TraId 
					inner join BDAcesso.dbo.TB_Sistemas s 
							on s.SisId = t.TraSisId
			  ",	
	
	"sql_update_permissions" :
			"select distinct  u.UsuPesIdPessoa as UserId,
								pt.PTrVisualizar as GrantGet,
								pt.PTrIncluir as GrantPost, 
								pt.PTrAlterar as UpdateGrant, 
								pt.PTrExcluir as GrantDelete,
								t.TraNomeFrm as Url,
								t.TraNomeMenu as name,
								u.UsuPesIdPessoa as user_id,  
								s.SisId as sis_id,
								pt.PTrId perfil_id
					from BDAcesso.dbo.TB_Usuario u join BDAcesso.dbo.TB_Acessos_Perfil up  
							on u.UsuId = up.APeUsuId 
					inner join BDAcesso.dbo.TB_Perfil p 
							on up.APePerId = p.PerId 
					inner join BDAcesso.dbo.TB_Perfil_Transacao pt 
							on p.PerId = pt.PTrPerId 
					inner join BDAcesso.dbo.TB_Transacao t 
							on pt.PTrTraId = t.TraId
					inner join BDAcesso.dbo.TB_Sistemas s 
							on s.SisId = t.TraSisId
				 where t.TraDataAlteracao >= ? or pt.PTrDataAlteracao >= ?
				"	
}
